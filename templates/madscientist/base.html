<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<title>{% block title %}
  {{ request.user }} | Mad Scientist
        {% endblock %}</title>
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}madscientist/css/all.css">
<link rel="shorcut icon" type="image/ico" href="{{ STATIC_URL}}madscientist/images/madscientist.ico"/>
</head>
<body>
{% load query_string_utilities %}
<div id="header" class="clearfix">
  
 <img id="title" alt="Mad Scientist" src="{{ STATIC_URL }}madscientist/images/logo_striped2.png"/> 
 <img id="tagline" alt="So. Many. Ideas." src="{{ STATIC_URL}}madscientist/images/so_many_ideas2.png"/>
 
 <ul id="menu_bar">
    <li>logged in as <a href="/madscientist/users/{{ request.user }}/">{{ request.user }}</a></li>
    <li><a href="/madscientist/logout/">logout</a></li>
 </ul>

  <ul id="tab_bar">
    {% for group in group_list %}
      {% if group.id == current_group.id %}
       <li class="active">{{ group.short_title}}</li>
      {% else %}
       <li><a href="/madscientist/groups/{{ group.id }}/">{{ group.short_title }}</a></li>
      {% endif %}
      
    {% endfor %}
  </ul>
  
 <div id="header-image"></div>
  
   
</div>
<div id="container" class="clearfix">
  
  <div id="content">
    
    {% block content %}  

      <div id="sidebar">      
      {% block sidebar %}
        <h1>Filters</h1>  
        
          {% if options.show_empty_tags %}
            <a href="/madscientist/groups/{{ current_group.id }}/?{{ active_options|remove_and_reencode:'show_empty_tags' }}&show_empty_tags=0">
              hide empty tags
            </a>
           {% else %}
            <a href="/madscientist/groups/{{ current_group.id }}/?{{ active_options|remove_and_reencode:'show_empty_tags' }}&show_empty_tags=1">
              show empty tags
            </a>        
           {% endif %}

        {% regroup tags by facet__name as tag_list %} 
        
        <!-- If all tags belong to a facet and we are currently showing empty tags, show an
             "Uncategorized" facet to add uncategorized tags to. -->
        {% if tag_list.0.grouper and active_options.show_empty_tags == "1" %}
          <h4>Uncategorized</h4>
          <ul class="facet clearfix">
            <li class="tag new_tag">+</li>
          </ul>
        {% endif %}
        
        {% for facet in tag_list %}
          
          <h4>{{ facet.grouper|default:"Uncategorized" }}</h4>
          <ul class="facet clearfix">
                       
            {% for tag in facet.list %}
            
              {% if tag.active %}
                <li class="tag active">
                          
                  <a href="/madscientist/groups/{{ current_group.id }}/?{{ active_options|remove_and_reencode:'tag' }}&{{ options.active_tags|remove_from_list:tag.id|encode_list:'tag' }}">
                  
                    {{ tag.name }} ({{ tag.num_ideas }})</a>
                </li>              
              {% else %}
                {% if not tag.num_ideas %}
                  <li class="tag empty">
                    {{ tag.name }} ({{ tag.num_ideas }})
                  </li>
                 {% else %}
                  <li class="tag">
                    
                    <a href="/madscientist/groups/{{ current_group.id }}/?{{ active_options|remove_and_reencode:'tag' }}&tag={{ tag.id }}&{{ options.active_tags|encode_list:'tag' }}">
                      {{ tag.name }} ({{ tag.num_ideas }})</a>
                  </li>
                  {% endif %}
              {% endif %}
            {% endfor %}
            <li class="tag new_tag hidden">+</li>
          </ul>
          
         {% empty %}
          
          <h4>Uncategorized</h4>
          <ul class="facet clearfix">
            <li class="tag new_tag hidden">+</li>
          </ul>
          
         {% endfor %}
         
        <!-- Show empty facets (if show_empty_tags is false this list will be empty ) -->
        {% if active_options.show_empty_tags == "1" %}
          
          {% for facet in empty_facets %}
            <h4>{{ facet.name }}</h4>
            <ul class="facet clearfix">
              <li class="tag new_tag hidden">+</li>
            </ul>
           {% endfor %}
        {% endif %}
         
         <div id="new_facet" class="hidden">Create new category</div>
      {% endblock sidebar %}
      </div>
    
    <div id="entry_container">
      <h1>{{ current_group.title }}</h1>

      <h4>{{ entry_list|length }} Entries Sorted By: <b>Date</b> | Title</h4>
      <ul id="entries">
        <li id="add_new_entry">Think of something brilliant? 
          <a href="/madscientist/groups/{{ current_group.id }}/add/">Write it down!</a>
        </li>
        
        {% for entry in entry_list %}
          <li>
              {% if entry.id|slugify == options.expand_id %}
              
               <span class="title">{{ entry.title }}
                  <a href="/madscientist/groups/{{ current_group.id }}/{{ entry.id }}/edit">(edit)</a>
                  <a href="/madscientist/groups/{{ current_group.id }}/{{ entry.id }}/delete">(delete)</a>                
                </span> 
         
                 {% if entry.body  %}
                  <span class="body">
                    {{ entry.body|linebreaks|safe }}
                  </span>
                  {% if entry.image %}<img src="{{ entry.image.url }}"/>{% endif %}
                {% endif %}
                
                <p class="tags">tags: {{ entry.tags.all|join:", "|default:"none" }}</p>
                
                <a href="/madscientist/groups/{{ current_group.id }}/?{{ active_options|remove_and_reencode:'expand' }}">(less)</a>
                
              {% else %}
              
                <span class="title">{{ entry.title }}
                </span> 
              
                {% if entry.body %}
                  &ndash; {{ entry.body|safe|truncatewords_html:10 }}
                {% endif %} 
                
                {% if entry.body or entry.tags.all|length > 0 or entry.image %}
                
                    <a href="/madscientist/groups/{{ current_group.id }}/?{{ active_options|remove_and_reencode:'expand' }}&expand={{ entry.id }}">(more)</a> 
                {% else %}
                  <a href="/madscientist/groups/{{ current_group.id }}/{{ entry.id }}/edit">(edit)</a>
                  <a href="/madscientist/groups/{{ current_group.id }}/{{ entry.id }}/delete">(delete)</a>                
                {% endif %}
                 
             {% endif %}
           </li>
        {% endfor %}
      </ul>
    </div>

  {% endblock content %}
  </div>

</div>

<div id="footer">

   <h2>The mad scientist in me says 'yes'!</h2>
    
    <!--Hey, what should go in this footer? A quote maybe? I do like quotes... maybe quotes from
    and about mad scientists, visionaries, prophets, inventors, and other crazy people?
    
    And maybe also organization and the benefits thereof? Union song ("unless we organize.." haha)
    -->
  
</div>

</body>
</html>